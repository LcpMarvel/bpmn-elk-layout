<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="definitions_call_activity" targetNamespace="http://example.com/test-call-activity" exporter="ELK-BPMN Test Generator" exporterVersion="1.0">
  <bpmn:process id="process_main" name="调用活动主流程" isExecutable="true">
    <bpmn:startEvent id="start_main" name="开始">
      <bpmn:outgoing>flow_1</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:serviceTask id="task_prepare" name="准备数据">
      <bpmn:incoming>flow_1</bpmn:incoming>
      <bpmn:outgoing>flow_2</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:callActivity id="call_subprocess_latest" name="调用子流程(最新)" calledElement="process_reusable_approval">
      <bpmn:incoming>flow_2</bpmn:incoming>
      <bpmn:outgoing>flow_3</bpmn:outgoing>
    </bpmn:callActivity>
    <bpmn:exclusiveGateway id="gateway_check_result" name="审批结果?" gatewayDirection="Diverging">
      <bpmn:incoming>flow_3</bpmn:incoming>
      <bpmn:outgoing>flow_approved</bpmn:outgoing>
      <bpmn:outgoing>flow_rejected</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:callActivity id="call_subprocess_version" name="调用指定版本" calledElement="process_payment">
      <bpmn:incoming>flow_approved</bpmn:incoming>
      <bpmn:outgoing>flow_4</bpmn:outgoing>
    </bpmn:callActivity>
    <bpmn:callActivity id="call_subprocess_deployment" name="调用部署版本" calledElement="process_notification">
      <bpmn:incoming>flow_4</bpmn:incoming>
      <bpmn:outgoing>flow_5</bpmn:outgoing>
    </bpmn:callActivity>
    <bpmn:callActivity id="call_mi_parallel" name="并行调用多实例" calledElement="process_item_processing">
      <bpmn:incoming>flow_5</bpmn:incoming>
      <bpmn:outgoing>flow_6</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics>
        <bpmn:loopDataInputRef>orderItems</bpmn:loopDataInputRef>
        <bpmn:loopDataOutputRef>processedItems</bpmn:loopDataOutputRef>
      </bpmn:multiInstanceLoopCharacteristics>
    </bpmn:callActivity>
    <bpmn:callActivity id="call_mi_sequential" name="顺序调用多实例" calledElement="process_approval_step">
      <bpmn:incoming>flow_6</bpmn:incoming>
      <bpmn:outgoing>flow_7</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics isSequential="true">
        <bpmn:loopDataInputRef>approvers</bpmn:loopDataInputRef>
        <bpmn:completionCondition xsi:type="bpmn:tFormalExpression">${rejected == true}</bpmn:completionCondition>
      </bpmn:multiInstanceLoopCharacteristics>
    </bpmn:callActivity>
    <bpmn:sendTask id="task_rejected_handler" name="发送拒绝通知">
      <bpmn:incoming>flow_rejected</bpmn:incoming>
      <bpmn:outgoing>flow_9</bpmn:outgoing>
    </bpmn:sendTask>
    <bpmn:serviceTask id="task_finalize" name="完成处理">
      <bpmn:incoming>flow_7</bpmn:incoming>
      <bpmn:outgoing>flow_8</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:endEvent id="end_success" name="成功结束">
      <bpmn:incoming>flow_8</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:endEvent id="end_rejected" name="拒绝结束">
      <bpmn:incoming>flow_9</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="flow_1" sourceRef="start_main" targetRef="task_prepare" />
    <bpmn:sequenceFlow id="flow_2" sourceRef="task_prepare" targetRef="call_subprocess_latest" />
    <bpmn:sequenceFlow id="flow_3" sourceRef="call_subprocess_latest" targetRef="gateway_check_result" />
    <bpmn:sequenceFlow id="flow_approved" name="通过" sourceRef="gateway_check_result" targetRef="call_subprocess_version">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isApproved == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="flow_rejected" name="拒绝" sourceRef="gateway_check_result" targetRef="task_rejected_handler">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isApproved == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="flow_4" sourceRef="call_subprocess_version" targetRef="call_subprocess_deployment" />
    <bpmn:sequenceFlow id="flow_5" sourceRef="call_subprocess_deployment" targetRef="call_mi_parallel" />
    <bpmn:sequenceFlow id="flow_6" sourceRef="call_mi_parallel" targetRef="call_mi_sequential" />
    <bpmn:sequenceFlow id="flow_7" sourceRef="call_mi_sequential" targetRef="task_finalize" />
    <bpmn:sequenceFlow id="flow_8" sourceRef="task_finalize" targetRef="end_success" />
    <bpmn:sequenceFlow id="flow_9" sourceRef="task_rejected_handler" targetRef="end_rejected" />
  </bpmn:process>
  <bpmn:process id="process_reusable_approval" name="可复用审批子流程" processType="Public" isExecutable="true">
    <bpmn:startEvent id="sub_start" name="开始">
      <bpmn:outgoing>sub_flow_1</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:userTask id="sub_task_review" name="审批">
      <bpmn:incoming>sub_flow_1</bpmn:incoming>
      <bpmn:outgoing>sub_flow_2</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:endEvent id="sub_end" name="结束">
      <bpmn:incoming>sub_flow_2</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="sub_flow_1" sourceRef="sub_start" targetRef="sub_task_review" />
    <bpmn:sequenceFlow id="sub_flow_2" sourceRef="sub_task_review" targetRef="sub_end" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_definitions_call_activity" name="BPMNDiagram">
    <bpmndi:BPMNPlane id="BPMNPlane_definitions_call_activity" bpmnElement="process_main">
      <bpmndi:BPMNShape id="process_main_di" bpmnElement="process_main">
        <dc:Bounds x="12" y="12" width="1121" height="204" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="start_main_di" bpmnElement="start_main">
        <dc:Bounds x="12" y="42.33333333333333" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="15" y="82.33333333333333" width="30" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="task_prepare_di" bpmnElement="task_prepare">
        <dc:Bounds x="68" y="20.333333333333332" width="100" height="80" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="68" y="20.333333333333332" width="56" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="call_subprocess_latest_di" bpmnElement="call_subprocess_latest">
        <dc:Bounds x="188" y="20.333333333333332" width="100" height="80" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="188" y="20.333333333333332" width="70" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="gateway_check_result_di" bpmnElement="gateway_check_result">
        <dc:Bounds x="308" y="35.33333333333333" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="301.5" y="17.33333333333333" width="63" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="call_subprocess_version_di" bpmnElement="call_subprocess_version">
        <dc:Bounds x="461" y="12" width="100" height="80" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="461" y="12" width="70" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="call_subprocess_deployment_di" bpmnElement="call_subprocess_deployment">
        <dc:Bounds x="581" y="12" width="100" height="80" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="581" y="12" width="56" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="call_mi_parallel_di" bpmnElement="call_mi_parallel">
        <dc:Bounds x="701" y="12" width="100" height="80" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="701" y="12" width="112" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="call_mi_sequential_di" bpmnElement="call_mi_sequential">
        <dc:Bounds x="833" y="12" width="100" height="80" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="833" y="12" width="98" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="task_rejected_handler_di" bpmnElement="task_rejected_handler">
        <dc:Bounds x="461" y="112" width="100" height="80" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="461" y="112" width="84" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="task_finalize_di" bpmnElement="task_finalize">
        <dc:Bounds x="953" y="12" width="100" height="80" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="953" y="12" width="56" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="end_success_di" bpmnElement="end_success">
        <dc:Bounds x="1073" y="34" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1076" y="74" width="30" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="end_rejected_di" bpmnElement="end_rejected">
        <dc:Bounds x="581" y="134" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="584" y="174" width="30" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="process_reusable_approval_di" bpmnElement="process_reusable_approval">
        <dc:Bounds x="454.5" y="276" width="236" height="104" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="sub_start_di" bpmnElement="sub_start">
        <dc:Bounds x="12" y="34" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="15" y="74" width="30" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="sub_task_review_di" bpmnElement="sub_task_review">
        <dc:Bounds x="68" y="12" width="100" height="80" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="68" y="12" width="30" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="sub_end_di" bpmnElement="sub_end">
        <dc:Bounds x="188" y="34" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="191" y="74" width="30" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="flow_1_di" bpmnElement="flow_1">
        <di:waypoint x="48" y="60.33333333333333" />
        <di:waypoint x="68" y="60.33333333333333" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="flow_2_di" bpmnElement="flow_2">
        <di:waypoint x="168" y="60.33333333333333" />
        <di:waypoint x="188" y="60.33333333333333" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="flow_3_di" bpmnElement="flow_3">
        <di:waypoint x="288" y="60.33333333333333" />
        <di:waypoint x="308" y="60.33333333333333" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="flow_approved_di" bpmnElement="flow_approved">
        <di:waypoint x="358" y="52" />
        <di:waypoint x="461" y="52" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="391" y="35" width="50" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="flow_rejected_di" bpmnElement="flow_rejected">
        <di:waypoint x="358" y="68.66666666666667" />
        <di:waypoint x="381" y="68.66666666666667" />
        <di:waypoint x="381" y="152" />
        <di:waypoint x="461" y="152" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="391" y="155" width="50" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="flow_4_di" bpmnElement="flow_4">
        <di:waypoint x="561" y="52" />
        <di:waypoint x="581" y="52" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="flow_5_di" bpmnElement="flow_5">
        <di:waypoint x="681" y="52" />
        <di:waypoint x="701" y="52" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="flow_6_di" bpmnElement="flow_6">
        <di:waypoint x="801" y="52" />
        <di:waypoint x="833" y="52" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="flow_7_di" bpmnElement="flow_7">
        <di:waypoint x="933" y="52" />
        <di:waypoint x="953" y="52" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="flow_8_di" bpmnElement="flow_8">
        <di:waypoint x="1053" y="52" />
        <di:waypoint x="1073" y="52" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="flow_9_di" bpmnElement="flow_9">
        <di:waypoint x="561" y="152" />
        <di:waypoint x="581" y="152" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="sub_flow_1_di" bpmnElement="sub_flow_1">
        <di:waypoint x="48" y="52" />
        <di:waypoint x="68" y="52" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="sub_flow_2_di" bpmnElement="sub_flow_2">
        <di:waypoint x="168" y="52" />
        <di:waypoint x="188" y="52" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
